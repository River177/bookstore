This chapter details the functional requirements of the online bookstore system. The system is logically divided into two major parts: the Front-end Store Subsystem and the Back-end Management Subsystem. The former serves book-buying users, while the latter serves administrators, achieving a closed business loop through data interaction.

#### Front-end Store Subsystem

The Front-end Subsystem acts as the direct interface between users and the platform. Its core objective is to ensure users can smoothly complete the entire process from searching and selecting to purchasing books.

The **User Account Module** serves as the foundation for system usage. The system supports two registration and login methods: username with password, and email with verification code. During the registration process, the back-end service (`UserService`) automatically verifies the uniqueness of the username and email, and utilizes the BCrypt algorithm to store user passwords with high-strength encryption, eliminating the risk of plaintext leakage. Upon successful registration, the system automatically initializes and assigns an exclusive shopping cart to the user via a trigger. The login state requires a persistence mechanism to avoid frequent credential entry. After logging in, users enter the Personal Center to maintain basic information such as nicknames and contact numbers. To support subsequent logistics delivery, the system designs `address`, `city`, and `postalCode` fields in the user table to store default shipping information, thereby automatically populating these details during order placement to simplify the operation. Furthermore, the Order Center aggregates all of the user's historical transactions, supporting filtering by statuses such as pending payment, pending shipment, and shipped. For shipped orders, it provides an entry point for querying tracking numbers and logistics trajectories.

The **Book Browsing and Retrieval Module** is responsible for visually presenting back-end data to users. The homepage features a "Hot Recommendations" section, where the system automatically sorts books in descending order based on the `salesCount` (cumulative sales) field, dynamically displaying the top eight most popular books. The system constructs a multi-level classification navigation system, allowing users to filter books by categories such as Literature or Technology. The top search bar adopts a fuzzy matching algorithm, supporting mixed retrieval based on book title, author, publisher, and ISBN. Simultaneously, the retrieval logic encompasses the book introduction (`description`) field to improve the recall rate. On the book details page, the system comprehensively displays the large cover image, pricing, real-time stock status, and content introduction to assist users in making purchasing decisions.

The **Shopping Cart and Transaction Settlement Module** represents the most complex part of the front-end business logic. The shopping cart possesses cross-session persistence capabilities, with data stored directly in the `ShoppingCart` and `CartItem` database tables rather than solely in local Cookies, ensuring cart content synchronization when users switch devices. Users can adjust purchase quantities and manage items in real-time, with the total price automatically calculated at the bottom. During the settlement process, the system performs a strict inventory pre-check; if a book's stock is lower than the purchase quantity or is in an off-shelf state (`status != 1`), the system will immediately intercept the request and prompt the user. When a user submits an order, the system employs the **Prisma Transaction mechanism** to atomically execute the following four actions:

1. Generate order records in the `Order` and `OrderItem` tables;
    
2. Deduct the corresponding book's `stockQuantity` and increase the `salesCount`;
    
3. Generate a system-level `StockLog` entry with the type "sale";
    
4. Clear the settled items from the shopping cart.
    
    This mechanism ensures strong data consistency under high-concurrency scenarios, effectively preventing product overselling.
    

#### Back-end Management Subsystem

The Back-end Subsystem is designed for operations personnel, primarily used for maintaining core data, processing business orders, and controlling system permissions.

The **Book and Inventory Management Module** is the foundation of operations. Administrators can publish new books via this module by entering the book title, ISBN, pricing, and rich-text introduction, and can also modify information for or remove existing books. Regarding inventory control, in addition to automatic system deductions due to sales, administrators can manually adjust stock quantities for scenarios like restocking or inventory auditing (stocktaking). To ensure asset security, the system automatically records the details of every inventory change into the `StockLog` table. Fields include the change type (`in`/`out`), change quantity, snapshot values before and after the change, and the operator type (Administrator/System), ensuring the flow of inventory is fully traceable. The system homepage dashboard also features built-in low-stock warning logic, automatically counting the number of books with stock below 10 to remind administrators to replenish inventory in a timely manner.

The **Order Processing Module** is used to guarantee fulfillment efficiency. Administrators can view the site-wide order list, supporting precise retrieval by order number, placement time, order status, and User ID. For orders in the "pending shipment" state, administrators verify the details and enter logistics information, updating the order status to `shipped` via the `updateOrderStatus` interface. Simultaneously, administrators can view order details containing purchase specifics and shipping information to handle refunds or after-sales inquiries. The system supports monthly revenue statistics (`monthlyRevenue`), calculating the total amount of completed orders for the current month through aggregate queries to assist with financial reconciliation.

The **User and Permission Management Module** is responsible for system security and compliance. Administrators can monitor the list of registered members, supporting fuzzy searches by username or email, and can execute freeze operations on violating accounts (setting `status` to 0). The system introduces an RBAC (Role-Based Access Control) model for permission control, supporting custom roles (e.g., Super Administrator, Ordinary Operator) and associating administrators with roles via the `AdminRole` table to achieve permission isolation. Additionally, the system enforces a mandatory audit mechanism; all critical operations (such as updating books, modifying order statuses, or freezing users) are recorded in the `OperationLog` table. The log content comprehensively covers operator information, the operation module (Module), the specific action (Action), the target object ID, and a text description of the change, providing a solid basis for internal audits and accountability tracking.