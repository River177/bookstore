本章节详细阐述网上书店系统的功能需求。系统在逻辑上划分为前台商城与后台管理两大部分，前者服务于购书用户，后者服务于管理员，二者通过数据交互实现业务闭环。

3.1 前台商城子系统

前台子系统是用户与平台交互的直接窗口，核心目标是确保用户能够流畅地完成从找书、选书到买书的全过程。

**用户账户模块**是使用系统的基础。系统支持用户名与密码、邮箱与验证码两种注册登录方式。在注册流程中，后端服务（`UserService`）会自动校验用户名与邮箱的唯一性，并利用 BCrypt 算法对用户密码进行高强度加密存储，杜绝明文泄露风险。用户注册成功后，系统通过触发器自动为其初始化分配一个专属购物车。登录状态需具备保持机制，避免用户频繁输入凭证。用户登录后进入个人中心，可维护昵称、联系电话等基础信息。为了支撑后续的物流配送，系统在用户表中设计了 `address`、`city` 及 `postalCode` 字段用于存储默认收货信息，从而在下单时自动填充，简化操作流程。此外，订单中心汇集了用户的所有历史交易，支持按待付款、待发货、已发货等状态筛选查看，针对已发货订单提供物流单号与轨迹查询入口。

**图书浏览与检索模块**负责将后台数据直观展示给用户。首页设有“热销推荐”栏目，系统依据图书的 `salesCount`（累计销量）字段自动降序排列，动态展示最受欢迎的前8本图书。系统构建了多级分类导航体系，用户可按文学、科技等层级筛选图书。顶部搜索栏采用模糊匹配算法，支持对书名、作者、出版社及 ISBN 进行混合检索，同时检索逻辑涵盖了图书简介（`description`）字段，以提高召回率。在图书详情页，系统完整展示封面大图、定价、实时库存状态及内容简介，辅助用户做出购买决策。

**购物车与交易结算模块**是前台业务逻辑最复杂的部分。购物车具备跨会话持久化能力，数据直接存储于数据库 `ShoppingCart` 与 `CartItem` 表中，而非仅存在于本地 Cookie，确保用户切换设备后购物车内容同步。用户可实时调整购买数量与批量管理商品，底部自动计算总价。结算流程中，系统执行严格的库存预检，若某图书库存量低于购买量或处于下架状态（`status != 1`），系统将即刻拦截并提示。用户提交订单时，系统采用 **Prisma 事务机制（Transaction）** 原子性地执行以下四个动作：

1.  在 `Order` 与 `OrderItem` 表中生成订单记录；
2.  扣减对应图书的 `stockQuantity` 并增加 `salesCount`；
3.  生成一条类型为 "sale" 的系统级 `StockLog` 库存变动日志；
4.  清空购物车中已结算的商品。
该机制确保了在高并发场景下的数据强一致性，有效防止商品超卖。

3.2 后台管理子系统

后台子系统供运营人员使用，主要用于维护核心数据、处理业务订单及管控系统权限。

**图书与库存管理模块**是运营的基础。管理员可通过该模块发布新书，录入书名、ISBN、定价及富文本简介，并支持对已上架图书进行信息变更或下架处理。在库存控制方面，除了系统因销售自动扣减外，管理员可针对进货或盘点损耗场景手动调整库存数量。为了保证资产安全，系统会自动记录每一次库存变动的详情至 `StockLog` 表，字段包含变动类型（`in`/`out`）、变动数量、变动前后的快照值以及操作人类型（管理员/系统），确保库存流向可完全追溯。系统首页仪表盘还内置了低库存预警逻辑，自动统计库存低于 10 本的图书数量，提醒管理员及时补货。

**订单处理模块**用于保障履约效率。管理员可查看全站订单列表，支持按订单号、下单时间、订单状态及用户 ID 进行精准检索。针对待发货状态的订单，管理员核实无误后录入物流信息，通过 `updateOrderStatus` 接口将订单状态更新为 `shipped`。同时，管理员可查看包含购买明细与收货信息的订单详情，以便处理退款或售后咨询。系统支持按月统计营收数据（`monthlyRevenue`），通过聚合查询计算当月已完成订单的总金额，辅助财务对账。

**用户与权限管理模块**负责系统的安全性与合规性。管理员可监控注册会员列表，支持按用户名或邮箱模糊搜索，并可对违规账号执行冻结操作（设置 `status` 为 0）。系统引入 RBAC 模型进行权限控制，支持自定义角色（如超级管理员、普通运营），通过 `AdminRole` 表关联管理员与角色，实现权限隔离。此外，系统强制实施审计机制，所有关键操作（如更新图书、修改订单状态、冻结用户）均会被记录到 `OperationLog` 表中。日志内容详尽涵盖了操作人信息、操作模块（Module）、具体行为（Action）、目标对象 ID 及变更内容的文本描述，为内部审计与责任追溯提供了详实依据。